{"filter":false,"title":"swarm.js","tooltip":"/test_ideas/swarm.js","undoManager":{"mark":71,"position":71,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":116,"column":0},"action":"insert","lines":["","/*loading mongodb*/    ","var mongojs = require(\"mongojs\")","var db = mongojs(\"mongodb://guest:guest@ds035448.mongolab.com:35448/bootable_version\");   ","","","","","var LINES = []","var dividendRate_quota_sum = 0","    var penalty = Boolean","","","","exports.compute_swarm = function(account_id, currency, dividend_amount, callback){","","lines_for_X(account_id)","","","","function lines_for_X(account){","    ","","    db.collection(account).findOne({ type:\"contract\", currency: currency },function (err, doc){","    ","    var dividendRate_line = doc.dividendRate"," db.collection(account).find({ type:\"dividend_pathway\", currency: currency },function (err, doc){","    ","","    for(var i=0;i<doc.length; i++){","            var temp_doc = doc[i] // quick fix","        ","          if(JSON.stringify(LINES).indexOf(temp_doc.account) ===-1){","//if(doc[i].account == account_id){console.log(\"CIRCULAR)}","if(temp_doc.account !== account_id){","    var penalty_dividendRate","    ","","    // Let's add incentive layer penalties:","","    db.collection(temp_doc.account).find({ type:\"incentive_layer_penalty\", currency: currency },function (err, doc){","        console.log(doc)","        if(doc.length!==0){","            ","            // get the lowest dividend rate that user has a penalty at","       penalty_dividendRate = doc[0].dividendRate","       for(var j=0;j<doc.length;j++){","            if(penalty_dividendRate<doc[j].dividendRate<penalty_dividendRate){","            penalty_dividendRate = doc[j].dividendRate","            }","        }","        if(penalty_dividendRate<dividendRate_line){penalty=true}","        console.log(\"penalty_dividendRate: \"+penalty_dividendRate)","        ","        }","    ","    //temp_doc.dividendRate","    //penalty_dividendRate","    ","    // Then continue again,","    console.log(temp_doc)","    if(temp_doc.dividendRate < dividendRate_line){","    var dividendRate_quota = temp_doc.dividendRate / dividendRate_line //eg. 0.02/0.03 = 0.66","    }","    else dividendRate_quota = 1","    ","    ","    // More penalty code:","    if(penalty == true){","        var dividendRate_quota_without_penalty = dividendRate_quota","            var dividendRate_quota = penalty_dividendRate / dividendRate_line","            console.log(\"dividendRate_quota_without_penalty: \"+dividendRate_quota_without_penalty)","        }","    ","    ","            ","            console.log(\"dividendRate_quota: \"+dividendRate_quota)","","            ","            ","        if(penalty == true)LINES.push({account: temp_doc.account, pathway: temp_doc.total_pathway, dividendRate_quota: dividendRate_quota, dividendRate_quota_without_penalty: dividendRate_quota_without_penalty, line: Number(LINES.length)}) ","        else LINES.push({account: temp_doc.account, pathway: temp_doc.total_pathway, dividendRate_quota: dividendRate_quota, line: Number(LINES.length)}) ","","       ","       ","       ","        dividendRate_quota_sum = Number(dividendRate_quota_sum) + Number(dividendRate_quota)","        ","        ","        ","              console.log(\"dividendRate_quota_sum: \"+dividendRate_quota_sum)","    })","          }","","        lines_for_X(temp_doc.account)","          }","          //else console.log(\"CIRCULAR\")","    }","","","","        });","","    })","        ","    }","","setTimeout(function(){","console.log(LINES)","","","    //callback(LINES, dividendRate_quota_sum, currency, account_id, dividend_amount)","    ","}, 3000)","    ","}",""]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":4},"end":{"row":103,"column":6},"action":"remove","lines":["})"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":0},"end":{"row":18,"column":2},"action":"insert","lines":["})"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":0},"end":{"row":23,"column":95},"action":"remove","lines":["    db.collection(account).findOne({ type:\"contract\", currency: currency },function (err, doc){"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":0},"end":{"row":18,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":0},"end":{"row":19,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":0},"end":{"row":19,"column":95},"action":"insert","lines":["    db.collection(account).findOne({ type:\"contract\", currency: currency },function (err, doc){"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":0},"end":{"row":19,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":21},"end":{"row":19,"column":22},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":21},"end":{"row":19,"column":22},"action":"remove","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":21},"end":{"row":19,"column":22},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":22},"end":{"row":19,"column":23},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":23},"end":{"row":19,"column":24},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":4},"end":{"row":27,"column":44},"action":"remove","lines":["var dividendRate_line = doc.dividendRate"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":94},"end":{"row":20,"column":0},"action":"insert","lines":["",""]},{"start":{"row":20,"column":0},"end":{"row":20,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":4},"end":{"row":20,"column":44},"action":"insert","lines":["var dividendRate_line = doc.dividendRate"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":55},"end":{"row":14,"column":56},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":56},"end":{"row":14,"column":57},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":57},"end":{"row":14,"column":58},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":58},"end":{"row":14,"column":59},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":59},"end":{"row":14,"column":60},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":60},"end":{"row":14,"column":61},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":61},"end":{"row":14,"column":62},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":62},"end":{"row":14,"column":63},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":63},"end":{"row":14,"column":64},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":64},"end":{"row":14,"column":65},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":64},"end":{"row":14,"column":65},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":63},"end":{"row":14,"column":64},"action":"remove","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":63},"end":{"row":14,"column":64},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":64},"end":{"row":14,"column":65},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":65},"end":{"row":14,"column":66},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":66},"end":{"row":14,"column":67},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":67},"end":{"row":14,"column":68},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":68},"end":{"row":14,"column":69},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":119,"column":0},"action":"remove","lines":["","/*loading mongodb*/    ","var mongojs = require(\"mongojs\")","var db = mongojs(\"mongodb://guest:guest@ds035448.mongolab.com:35448/bootable_version\");   ","","","","","var LINES = []","var dividendRate_quota_sum = 0","    var penalty = Boolean","","","","exports.compute_swarm = function(account_id, currency, dividendRate, dividend_amount, callback){","","lines_for_X(account_id)","","","db.collection(account_id).findOne({ type:\"contract\", currency: currency },function (err, doc){","    var dividendRate_line = doc.dividendRate","})","","function lines_for_X(account){","    ","","","    ","    "," db.collection(account).find({ type:\"dividend_pathway\", currency: currency },function (err, doc){","    ","","    for(var i=0;i<doc.length; i++){","            var temp_doc = doc[i] // quick fix","        ","          if(JSON.stringify(LINES).indexOf(temp_doc.account) ===-1){","//if(doc[i].account == account_id){console.log(\"CIRCULAR)}","if(temp_doc.account !== account_id){","    var penalty_dividendRate","    ","","    // Let's add incentive layer penalties:","","    db.collection(temp_doc.account).find({ type:\"incentive_layer_penalty\", currency: currency },function (err, doc){","        console.log(doc)","        if(doc.length!==0){","            ","            // get the lowest dividend rate that user has a penalty at","       penalty_dividendRate = doc[0].dividendRate","       for(var j=0;j<doc.length;j++){","            if(penalty_dividendRate<doc[j].dividendRate<penalty_dividendRate){","            penalty_dividendRate = doc[j].dividendRate","            }","        }","        if(penalty_dividendRate<dividendRate_line){penalty=true}","        console.log(\"penalty_dividendRate: \"+penalty_dividendRate)","        ","        }","    ","    //temp_doc.dividendRate","    //penalty_dividendRate","    ","    // Then continue again,","    console.log(temp_doc)","    if(temp_doc.dividendRate < dividendRate_line){","    var dividendRate_quota = temp_doc.dividendRate / dividendRate_line //eg. 0.02/0.03 = 0.66","    }","    else dividendRate_quota = 1","    ","    ","    // More penalty code:","    if(penalty == true){","        var dividendRate_quota_without_penalty = dividendRate_quota","            var dividendRate_quota = penalty_dividendRate / dividendRate_line","            console.log(\"dividendRate_quota_without_penalty: \"+dividendRate_quota_without_penalty)","        }","    ","    ","            ","            console.log(\"dividendRate_quota: \"+dividendRate_quota)","","            ","            ","        if(penalty == true)LINES.push({account: temp_doc.account, pathway: temp_doc.total_pathway, dividendRate_quota: dividendRate_quota, dividendRate_quota_without_penalty: dividendRate_quota_without_penalty, line: Number(LINES.length)}) ","        else LINES.push({account: temp_doc.account, pathway: temp_doc.total_pathway, dividendRate_quota: dividendRate_quota, line: Number(LINES.length)}) ","","       ","       ","       ","        dividendRate_quota_sum = Number(dividendRate_quota_sum) + Number(dividendRate_quota)","        ","        ","        ","              console.log(\"dividendRate_quota_sum: \"+dividendRate_quota_sum)","    })","          }","","        lines_for_X(temp_doc.account)","          }","          //else console.log(\"CIRCULAR\")","    }","","","","        });","","    ","        ","    }","","setTimeout(function(){","console.log(LINES)","","","    //callback(LINES, dividendRate_quota_sum, currency, account_id, dividend_amount)","    ","}, 3000)","    ","}",""]},{"start":{"row":0,"column":0},"end":{"row":2,"column":2},"action":"insert","lines":["  function filter_dividend_pathways_by_dividendRate(){","       db.collection(account).find({ type:\"dividend_pathway\", currency: currency, dividendRate: { $lte: dividendRate_X} },function (err, doc){","})"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":3,"column":0},"action":"insert","lines":["/*loading mongodb*/    ","var mongojs = require(\"mongojs\")","var db = mongojs(\"mongodb://guest:guest@ds035448.mongolab.com:35448/bootable_version\");   ",""]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":2},"end":{"row":8,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"insert","lines":["}"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":5,"column":1},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":1},"end":{"row":5,"column":2},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":2},"end":{"row":5,"column":3},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":3},"end":{"row":5,"column":4},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":4},"end":{"row":5,"column":5},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":5},"end":{"row":5,"column":6},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":6},"end":{"row":5,"column":7},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":6},"end":{"row":5,"column":7},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":5},"end":{"row":5,"column":6},"action":"remove","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":4},"end":{"row":5,"column":5},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":3},"end":{"row":5,"column":4},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":2},"end":{"row":5,"column":3},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":1},"end":{"row":5,"column":2},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":5,"column":1},"action":"remove","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":5,"column":1},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":1},"end":{"row":5,"column":2},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":2},"end":{"row":5,"column":3},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":3},"end":{"row":5,"column":4},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":4},"end":{"row":5,"column":5},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":5},"end":{"row":5,"column":6},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":6},"end":{"row":5,"column":7},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":7},"end":{"row":5,"column":8},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":8},"end":{"row":5,"column":9},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":9},"end":{"row":5,"column":10},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":10},"end":{"row":5,"column":11},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":11},"end":{"row":5,"column":12},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":12},"end":{"row":5,"column":13},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":13},"end":{"row":5,"column":14},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":14},"end":{"row":5,"column":16},"action":"insert","lines":["\"\""]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":15},"end":{"row":5,"column":49},"action":"insert","lines":["rLaKjMvLbrAJwnH4VpawQ6ot9epZqJmbfQ"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":5,"column":49},"end":{"row":5,"column":49},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1428740541325,"hash":"36d6c2b461313b928f9dcaa749b990d169f0ab10"}